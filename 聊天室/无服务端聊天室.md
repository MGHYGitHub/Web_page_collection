# 无服务端聊天室 - 完整功能版

一个基于浏览器文件系统API的完全去中心化聊天应用，支持文字和图片消息，无需服务器即可实现多人实时聊天。

## 🌟 全新特性

### 图片消息功能
- **📷 图片上传**：支持选择本地图片文件发送
- **🔍 图片预览**：点击图片查看大图，支持全屏预览
- **💾 图片存储**：Base64编码存储，完全去中心化
- **📏 智能压缩**：自动限制图片大小（10MB以内）

### 核心技术
- **零服务器依赖**：使用浏览器File System Access API实现去中心化通信
- **文件系统存储**：聊天数据存储在本地文件系统中
- **实时同步**：基于轮询机制实现消息实时更新
- **跨平台兼容**：支持所有现代浏览器

## 🚀 快速开始

### 环境要求
- 现代浏览器（Chrome 86+、Edge 86+、Firefox 111+）
- 支持File System Access API
- 需要授予文件系统访问权限

### 使用步骤

1. **打开应用**
   ```bash
   # 将HTML文件保存到本地后直接在浏览器中打开
   ```

2. **设置用户名**
   - 首次打开时会提示输入用户名
   - 支持中文、英文等任意字符
   - 可随机生成默认用户名

3. **选择聊天室**
   - 从左侧边栏的下拉菜单中选择聊天室
   - 支持"聊天室1"到"聊天室5"等预设选项
   - 系统会自动创建对应的文件夹

4. **开始聊天**
   - **文字消息**：在输入框输入文字，按Enter或点击发送
   - **图片消息**：
     - 点击📷按钮选择图片文件
     - 或直接粘贴剪贴板中的图片
     - 支持截图后直接粘贴

5. **查看图片**
   - 点击聊天中的图片查看大图
   - 点击大图或按ESC键返回

## 🖼️ 图片功能详解

### 图片上传方式
1. **文件选择**：点击相机图标选择本地图片文件
2. **直接粘贴**：
   - Windows: `Ctrl + V` 或右键粘贴
   - Mac: `Cmd + V` 或右键粘贴
   - 移动端: 长按输入框选择粘贴

### 支持的图片格式
- JPEG/JPG
- PNG
- GIF
- WebP
- BMP

### 图片大小限制
- 最大文件大小：5MB
- 自动压缩超大图片
- 格式验证确保只接受图片文件

## 📁 文件结构

### 数据存储
```
聊天室文件夹/
├── chat.json          # 聊天消息数据（包含Base64图片）
└── users.json         # 用户状态数据
```

### 消息格式
**文本消息**
```json
{
  "id": 时间戳,
  "user": "用户名",
  "text": "消息内容",
  "time": "时间",
  "type": "text"
}
```

**图片消息**
```json
{
  "id": 时间戳,
  "user": "用户名",
  "text": "图片消息",
  "image": "data:image/png;base64,...",
  "time": "时间",
  "type": "image"
}
```

## 🎮 快捷键操作

| 操作 | 快捷键 | 说明 |
|------|--------|------|
| 发送消息 | `Enter` | 快速发送文字消息 |
| 粘贴图片 | `Ctrl+V` / `Cmd+V` | 粘贴剪贴板中的图片 |
| 取消上传 | `ESC` | 取消图片上传 |
| 关闭预览 | `ESC` 或点击背景 | 关闭图片预览 |

## 📱 移动端使用

### 移动端特色功能
- **触摸优化**：针对触摸屏优化的界面元素
- **图片预览**：支持手势缩放图片
- **键盘适配**：自动调整界面避免键盘遮挡

### 移动端操作指南
1. **发送图片**：
   - 点击📷按钮选择照片
   - 或长按输入框选择粘贴

2. **查看图片**：
   - 点击图片查看大图
   - 双指缩放查看细节
   - 单击返回聊天界面

## ⚠️ 注意事项

### 浏览器兼容性
| 浏览器 | 支持状态 | 图片功能 |
|--------|----------|----------|
| Chrome | ✅ 完全支持 | 所有功能可用 |
| Edge | ✅ 完全支持 | 所有功能可用 |
| Firefox | ✅ 基本支持 | 粘贴功能可能受限 |
| Safari | ⚠️ 部分支持 | 有限的文件系统访问 |

### 使用限制
1. **存储空间**：Base64图片会显著增加文件大小
2. **性能考虑**：大量图片可能影响加载速度
3. **隐私注意**：图片存储在本地文件中，请注意隐私

## 🛠️ 技术架构

### 核心技术栈
- **HTML5 File System Access API** - 文件系统访问
- **Clipboard API** - 剪贴板图片处理
- **Canvas API** - 图片压缩和处理
- **原生JavaScript ES6+** - 应用逻辑

### 图片处理流程
```
用户操作 → 图片获取 → 格式验证 → 大小检查 → Base64编码 → 消息存储
```

## 🔧 自定义配置

### 修改图片大小限制
编辑JavaScript中的大小限制（约第200行）：
```javascript
// 修改图片大小限制（单位：字节）
if (file.size > 10 * 1024 * 1024) { // 改为10MB
    showNotification('图片大小不能超过10MB');
    return;
}
```

### 添加支持的图片格式
修改accept属性和验证逻辑：
```html
<input type="file" id="imageUpload" accept="image/*, .heic, .heif">
```

## 🆘 常见问题

### Q: 图片发送失败怎么办？
A: 尝试：
- 检查图片大小是否超过限制
- 尝试使用其他图片格式
- 重新选择或粘贴图片

### Q: 如何备份聊天记录？
A: 直接备份整个聊天室文件夹，所有图片都包含在JSON文件中。

### Q: 图片会占用很多空间吗？
A: 是的，Base64编码会使文件大小增加约33%，建议定期清理不需要的聊天室。

## 🔮 未来发展

### 计划功能
- [ ] 图片压缩优化
- [ ] 多图片同时发送
- [ ] 图片搜索功能
- [ ] 图片批量管理
- [ ] 云端图片备份

### 技术优化
- [ ] WebP格式自动转换
- [ ] 懒加载图片
- [ ] 图片缓存机制
- [ ] 离线图片查看

## 📄 许可证

MIT License - 可自由使用、修改和分发。

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进图片功能或添加新特性！

## 📞 支持联系

如有图片功能问题请提交GitHub Issue。

---

**享受去中心化聊天的自由与便捷！现在支持文字和图片消息！** 🎉📸