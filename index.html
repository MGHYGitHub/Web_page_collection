<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æç®€å¯¼èˆªé¢æ¿</title>
  <!-- é¢„åŠ è½½CSSæé«˜æ€§èƒ½ -->
  <link rel="preload" href="style.css" as="style">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/x-icon" href="./icons/dh.ico">
</head>
<body>
  <div class="container">
    <div class="layout-wrapper">
      <div class="main-content">
        <header>
          <h1>æç®€å¯¼èˆª</h1>
          <p class="subtitle">å¿«é€Ÿè®¿é—®æ‚¨çš„æ•°å­—èµ„æº</p>
        </header>
        
        <div class="search-container">
          <input type="text" class="search-input" placeholder="æœç´¢å¯¼èˆªé¡¹..." aria-label="æœç´¢å¯¼èˆªé¡¹">
        </div>
        
        <div class="category-filter" id="categoryFilter"></div>
        
        <div class="cards-container" id="cardsContainer"></div>
      </div>
    </div> <!-- é—­åˆ layout-wrapper -->
  </div> <!-- é—­åˆ container -->

  <div class="announcement-modal" id="announcementModal">
    <div class="announcement-content">
      <div class="announcement-header">
        <h3>ğŸ“¢ é‡è¦å…¬å‘Š</h3>
        <button class="announcement-close" onclick="closeAnnouncement()">Ã—</button>
      </div>
      <div class="announcement-body">
        <div class="announcement-item">
          <div class="announcement-title">ä¸ªäººé›†åˆå¯¼èˆªç«™</div>
          <div class="announcement-text">è¿™æ˜¯ä¸€ä¸ªå¯¼èˆªç«™,ç”¨äºä¸ªäººé“¾æ¥é›†åˆå½•ã€‚</div>
          <div class="announcement-text">å¯å‰å¾€ä»“åº“ä¸‹è½½åšå†…ç½‘ä½¿ç”¨ï¼ŒåŒºåˆ†å†…å¤–ç½‘åŒç‰ˆæœ¬</div>
          <div class="announcement-text">âŒä¸¥æ ¼ç¦æ­¢âŒä»»ä½•éä¸ªäººå¼€å‘åŸåˆ›ï¼ˆå«æºæ‚å…¬å¸å†…éƒ¨é“¾æ¥ç­‰ä¿¡æ¯ï¼‰æˆ–åœ¨å¤–ç½‘æ•£å¸ƒå†…éƒ¨æ¶ˆæ¯</div>
        </div>
        <div class="announcement-item">
          <div class="announcement-title">é¡¹ç›®GitHubä»“åº“</div>
          <div class="announcement-text">
            æ¬¢è¿è®¿é—®æˆ‘ä»¬çš„GitHubä»“åº“ï¼š
            <a href="https://github.com/MGHYGitHub/Web_page_collection" 
               target="_blank" 
               style="color: var(--primary-color); text-decoration: underline;">
              Github
            </a>
          </div>
        </div>
      </div>
      <div class="announcement-footer">
        <button class="announcement-action dont-show" onclick="dontShowAnnouncement()">24å°æ—¶å†…ä¸å†æ˜¾ç¤º</button>
        <button class="announcement-action confirm" onclick="closeAnnouncement()">æˆ‘çŸ¥é“äº†</button>
      </div>
    </div>
  </div>

  <!-- å¼‚æ­¥åŠ è½½JS -->
  <script src="links.js" defer></script>
  <script>
    // å…¨å±€å‡½æ•°
    function closeAnnouncement() {
      const modal = document.getElementById('announcementModal');
      modal.classList.remove('show');
    }

    function dontShowAnnouncement() {
      const now = new Date();
      const dontShowUntil = now.setDate(now.getDate() + 1);
      localStorage.setItem('announcementDontShowUntil', dontShowUntil.toString());
      closeAnnouncement();
    }

    document.addEventListener('DOMContentLoaded', function() {
      // æ£€æŸ¥æœ¬åœ°å­˜å‚¨æ˜¯å¦è®¾ç½®äº†ä¸æ˜¾ç¤º
      const dontShowUntil = localStorage.getItem('announcementDontShowUntil');
      const now = new Date().getTime();
      
      if (!dontShowUntil || now > parseInt(dontShowUntil)) {
        // æ˜¾ç¤ºå…¬å‘Šå¼¹çª—
        setTimeout(() => {
          const modal = document.getElementById('announcementModal');
          modal.classList.add('show');
          
          // 20ç§’åè‡ªåŠ¨å…³é—­
          setTimeout(() => {
            if (modal.classList.contains('show')) {
              closeAnnouncement();
            }
          }, 20000);
        }, 1000);
      }

      // ä¸»é€»è¾‘
      const cardsContainer = document.getElementById('cardsContainer');
      const categoryFilter = document.getElementById('categoryFilter');
      const searchInput = document.querySelector('.search-input');
      
      // è·å–æ‰€æœ‰åˆ†ç±»
      const categories = [...new Set(linksData.map(item => item.category))];
      
      // ç”Ÿæˆåˆ†ç±»æŒ‰é’®
      function renderCategoryButtons() {
        categoryFilter.innerHTML = '';
        
        // æ·»åŠ "å…¨éƒ¨"æŒ‰é’®
        const allBtn = document.createElement('button');
        allBtn.className = 'category-btn active';
        allBtn.textContent = 'å…¨éƒ¨';
        allBtn.dataset.category = 'all';
        allBtn.addEventListener('click', filterByCategory);
        categoryFilter.appendChild(allBtn);
        
        // æ·»åŠ å…¶ä»–åˆ†ç±»æŒ‰é’®
        categories.forEach(category => {
          const btn = document.createElement('button');
          btn.className = 'category-btn';
          btn.textContent = category;
          btn.dataset.category = category;
          btn.addEventListener('click', filterByCategory);
          categoryFilter.appendChild(btn);
        });
      }
      
        // ç”Ÿæˆå¡ç‰‡
        function renderCards(data) {
          cardsContainer.innerHTML = '';
          
          data.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            card.dataset.category = item.category;
            
            // åˆ›å»ºå›¾æ ‡å®¹å™¨
            const iconContainer = document.createElement('div');
            iconContainer.className = 'icon-container';
            
            // 1. ä¼˜å…ˆä½¿ç”¨æœ¬åœ°å›¾æ ‡
            if (item.localIcon) {
              iconContainer.innerHTML = `<img src="${item.localIcon}" alt="${item.name}" class="card-icon-img">`;
            } 
            // 2. å¦åˆ™å¤„ç†åœ¨çº¿å›¾æ ‡
            else {
              try {
                // å°è¯•è§£æURL
                const domain = new URL(item.url).hostname;
                const faviconUrl = `https://${domain}/favicon.ico`;
                
                const img = document.createElement('img');
                img.src = faviconUrl;
                img.alt = item.name;
                img.className = 'card-icon-img';
                
                img.onerror = () => {
                  // 3. faviconåŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºæŒ‡å®šçš„emojiæˆ–é»˜è®¤å›¾æ ‡
                  showFallbackIcon(iconContainer, item.icon);
                };
                
                iconContainer.appendChild(img);
              } catch (e) {
                // 4. URLè§£æå¤±è´¥ï¼ˆå¦‚é“¾æ¥é”™è¯¯ï¼‰ç›´æ¥æ˜¾ç¤ºå¤‡ç”¨å›¾æ ‡
                showFallbackIcon(iconContainer, item.icon);
              }
            }
            
            card.innerHTML = `
              <div class="card-content">
                <h3 class="card-title">${item.name}</h3>
                <p class="card-main-desc">${item.mainDesc}</p>
                <p class="card-sub-desc">${item.subDesc}</p>
                <a href="${item.url}" target="_blank" class="card-link" title="è®¿é—®${item.name}" aria-label="è®¿é—®${item.name}"></a>
              </div>
            `;
            
            // å°†å›¾æ ‡å®¹å™¨æ’å…¥åˆ°å¡ç‰‡å†…å®¹çš„æœ€å‰é¢
            card.querySelector('.card-content').prepend(iconContainer);
            cardsContainer.appendChild(card);
          });
        }

        // æ˜¾ç¤ºå¤‡ç”¨å›¾æ ‡çš„è¾…åŠ©å‡½æ•°
        function showFallbackIcon(container, emoji) {
          container.innerHTML = emoji 
            ? `<div class="card-icon">${emoji}</div>`
            : '<div class="card-icon">ğŸŒ</div>';
        }
      
      // åˆ†ç±»ç­›é€‰
      function filterByCategory(e) {
        const category = e.target.dataset.category;
        
        document.querySelectorAll('.category-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        e.target.classList.add('active');
        
        if (category === 'all') {
          renderCards(linksData);
        } else {
          const filteredData = linksData.filter(item => item.category === category);
          renderCards(filteredData);
        }
      }
      
      // æœç´¢åŠŸèƒ½
      searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const activeCategory = document.querySelector('.category-btn.active').dataset.category;
        
        let filteredData = linksData;
        
        if (activeCategory !== 'all') {
          filteredData = linksData.filter(item => item.category === activeCategory);
        }
        
        filteredData = filteredData.filter(item => 
          item.name.toLowerCase().includes(searchTerm) || 
          item.mainDesc.toLowerCase().includes(searchTerm) ||
          item.subDesc.toLowerCase().includes(searchTerm)
        );
        
        renderCards(filteredData);
      });
      
      // åˆå§‹åŒ–
      renderCategoryButtons();
      renderCards(linksData);
    });
  </script>
</body>
</html>
